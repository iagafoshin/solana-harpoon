# TODO: solana_extractor roadmap

Этот файл собирает идеи по улучшению инструмента. Всё уже работает и может использоваться сейчас; ниже — вещи для удобства, масштабируемости и будущего себя.

---

## Приоритеты

- **P0 — перед большими ночными прогонами**
- **P1 — v1.1 (качество жизни, удобство)**
- **P2 — v2.0 (оптимизации и красота)**

---

## P0 — Минимальные проверки перед масштабом

- [ ] Прогнать парсер на 1–2 эпохах и глазами проверить:
  - [ ] Структуру Parquet (поля, типы, списки).
  - [ ] Что фильтрация по программам работает как ожидается.
  - [ ] Что лог/статистика соответствуют интуиции (кол-во транзакций, совпадений и т.д.).
- [ ] Зафиксировать для себя «контракт» схемы:
  - [ ] Какие поля точно считаем стабильными.
  - [ ] Какие можно будет менять в будущем.

---

## P1 — Режимы работы: скачивание vs парсинг

**Цель:** разделить обязанности бинарника и добавить гибкости.

- [ ] Добавить режимы работы:
  - [ ] «Скачать только» (download-only) — без парсинга, просто загрузка CAR-файлов по эпохам.
  - [ ] «Парсить только» (parse-only) — использовать только уже лежащие CAR-файлы, без сетевых запросов.
  - [ ] Комбинированный режим (как сейчас) — при отсутствии CAR скачивать и потом сразу парсить.
- [ ] Добавить опцию «не удалять CAR после парсинга»:
  - [ ] Флаг вроде `keep_car` (название на своё усмотрение).
  - [ ] Поведение по умолчанию явно задокументировать (удаляем или храним).

---

## P1 — Гибкое управление эпохами

**Цель:** удобно задавать, какие эпохи обрабатывать, и как вести себя при дырках.

- [ ] Поддержать несколько способов задания эпох:
  - [ ] «Последние N эпох» (как сейчас).
  - [ ] Явный диапазон: от `epoch_start` до `epoch_end`.
  - [ ] Список эпох (например, через CLI или конфиг).
- [ ] Настраиваемое поведение при проблемах с эпохой:
  - [ ] Строгий режим: падать, если эпоху не удалось скачать/распарсить.
  - [ ] Мягкий режим: логировать ошибку, пропускать эпоху и продолжать остальные.
  - [ ] В конце выводить список эпох, которые:
    - [ ] Не удалось скачать.
    - [ ] Не удалось распарсить.

---

## P1 — Именование выходных файлов и версия схемы

**Цель:** чтобы Parquet-файлы были самодокументируемыми.

- [ ] Пересмотреть схему именования Parquet:
  - [ ] Сделать имя менее «завязано на китов» и более универсальным (например, включать epoch и набор программ).
  - [ ] Подумать про структуру директории (по epoch / по дате).
- [ ] Добавить в Parquet явную версию схемы:
  - [ ] Поле `schema_version` (в метаданных или в колонке).
  - [ ] Зафиксировать текущую версию как `v1`, чтобы при изменениях понимать, что где ломается.
- [ ] Добавить краткое текстовое описание схемы в README или отдельный `SCHEMA.md`:
  - [ ] Список полей.
  - [ ] Типы.
  - [ ] Краткий смысл каждого поля.

---

## P1 — Конфиг-файл

**Цель:** хранить дефолтные настройки не только в CLI.

- [ ] Ввести небольшой конфиг-файл (например, TOML/YAML) в рабочей директории:
  - [ ] Дефолтный список программ для фильтрации.
  - [ ] Путь к `aria2c`, если он не в PATH.
  - [ ] Дефолтное число одновременных эпох (concurrency).
  - [ ] Дефолтные флаги по парсингу/декодированию.
- [ ] Определить приоритеты:
  - [ ] Значения из CLI перекрывают конфиг.
  - [ ] Значения из конфига перекрывают значения по умолчанию в коде.
- [ ] Описать формат конфига в README.

---

## P1 — Документация и бинарники

**Цель:** чтобы будущий ты и другие люди не путались.

- [ ] Привести README к одному каноническому имени основного бинарника:
  - [ ] Описать, что делает основной бинарник (экстрактор).
  - [ ] Описать, что делает вспомогательный бинарник (например, простой счётчик нод в CAR).
  - [ ] Удалить или явно пометить legacy-имена (старый `pumpfun_dump` и т.п.).
- [ ] Добавить раздел «Сценарии использования»:
  - [ ] «Вытащить все транзакции интересующей программы за X эпох».
  - [ ] «Просто посчитать размер/структуру CAR».
  - [ ] «Использовать этот парсер для другой программы».
- [ ] Добавить раздел «Сборка и запуск тестов»:
  - [ ] Как собрать.
  - [ ] Как гонять базовые проверки/тесты.
- [ ] Явно указать и пояснить тип лицензии (AGPL и последствия для пользователей кода).

---

## P2 — Производительность и тюнинг

**Цель:** выжать максимум при массе данных, не превратив код в кашу.

- [ ] Пересмотреть стратегию параллелизма:
  - [ ] Определить разумный диапазон `concurrency` по эпохам (например, относительно числа ядер).
  - [ ] При необходимости ограничить внутренний пул потоков, чтобы не было оверсабскрипции.
  - [ ] Задокументировать рекомендованные настройки для «маленьких» и «больших» машин.
- [ ] Управляемый pre-filter по байтам (Aho–Corasick и подобное):
  - [ ] Добавить флаг, позволяющий отключать грубую фильтрацию и фильтровать только по аккаунтам после декода.
  - [ ] Задокументировать, когда это выгодно (например, если программа встречается слишком часто).
  - [ ] (Опционально) В будущем подумать об автоматическом отключении pre-filter при высоком проценте совпадений.
- [ ] Настраиваемый размер батча при записи Parquet:
  - [ ] Вынести размер буфера записей в параметр.
  - [ ] Задокументировать trade-off: память vs скорость.

---

## P2 — Статистика, логи и отчёты

**Цель:** удобно мониторить большие прогоны и понимать, что произошло.

- [ ] Для каждой эпохи печатать краткий summary:
  - [ ] Количество транзакций всего.
  - [ ] Количество транзакций, прошедших фильтр по программе.
  - [ ] Количество транзакций с ошибками декода/метаданных.
  - [ ] Время обработки эпохи.
  - [ ] Среднюю скорость в tx/сек.
- [ ] Для всего запуска печатать общий summary:
  - [ ] Список успешных эпох.
  - [ ] Список проблемных эпох (по отдельным категориям: качание, парсинг и т.д.).
  - [ ] Общую статистику по транзакциям и ошибкам.
- [ ] Чётко разделить уровни логов:
  - [ ] Инфо (основной прогресс).
  - [ ] Ворнинги (пропуски отдельных транзакций/нод).
  - [ ] Ошибки (падения по эпохе/скачиванию и т.п.).

---

## P2 — Обработка ошибок

**Цель:** управляемое поведение при битыx данных/сетевых проблемах.

- [ ] Для ошибок скачивания/битых CAR:
  - [ ] В строгом режиме — завершать с ошибкой.
  - [ ] В мягком режиме — помечать эпоху как проблемную и продолжать.
  - [ ] В summary показывать, что именно пошло не так по каждой эпохе.
- [ ] Для ошибок на уровне отдельных нод/транзакций:
  - [ ] Разделить два режима:
    - [ ] «Строгий» — любая неожиданная структура/ошибка декода валит обработку.
    - [ ] «Толерантный» — такие случаи учитываются в статистике, но процесс продолжается.
  - [ ] Логирование примеров проблемных транзакций (ограниченное число, чтобы не заспамить логи).

---

## P2 — Гигиена репозитория

**Цель:** не тащить мусор в git и архивы.

- [ ] Добавить в `.gitignore`:
  - [ ] `.DS_Store`
  - [ ] `__MACOSX/`
  - [ ] Директории с данными (`data/` или аналогичные).
  - [ ] Временные файлы IDE/редактора.
- [ ] Проверить, что в архивы/релизы не попадают:
  - [ ] Временные файлы и артефакты сборки.
  - [ ] Личные/локальные конфиги.

---

## Пометки на будущее

- [ ] Подумать о более «высокоуровневых» командах:
  - [ ] Команда для полного пайплайна: «скачай+распарсь X эпох и подготовь parquet для конкретного юзкейса».
  - [ ] Packaged-пресеты под разные протоколы (Pump.fun, Raydium и т.д.).
- [ ] При изменении схемы и логики:
  - [ ] Обновлять `schema_version`.
  - [ ] Вести короткий `CHANGELOG` по схемам и контрактам данных.